(node:23826) [MODULE_TYPELESS_PACKAGE_JSON] Warning: Module type of file:///home/japhet/Desktop/joyvault/joyvault-contract/tests/devnet-real-test.ts is not specified and it doesn't parse as CommonJS.
Reparsing as ES module because module syntax was detected. This incurs a performance overhead.
To eliminate this warning, add "type": "module" to /home/japhet/Desktop/joyvault/joyvault-contract/package.json.
(Use `node --trace-warnings ...` to show where the warning was created)


  üî• REAL DEVNET BRUTAL TESTS üî•

üî• STARTING REAL DEVNET SECURITY AUDIT üî•

Main Wallet: Hwnagq6nu7tLMDYaaDLnQ4X4FiyfGv5hcMifYr13CZxd
Main Balance: 2.08009796 SOL

Funding test accounts from main wallet...
Note: Using alternative funding method...

    1Ô∏è‚É£ CONFIG & INITIALIZATION TESTS
   Config not initialized yet (expected for first run)
      ‚úî ‚úÖ Should check if config exists (381ms)
   Initializing config...
      1) ‚úÖ Should initialize OR skip config if exists
    2Ô∏è‚É£ VAULT CREATION TESTS
   Creating new vault...
   ‚úÖ Vault created successfully
      ‚úî ‚úÖ Should create new vault OR fetch existing (3451ms)
   ‚úÖ ATTACK BLOCKED: Duplicate vault rejected
      ‚úî ‚ùå ATTACK TEST: Cannot create duplicate vault (766ms)
    3Ô∏è‚É£ SECRET STORAGE TESTS
   Adding secret...
      2) ‚úÖ Should add secret to vault
   Testing 1024-byte secret...
      3) ‚úÖ BOUNDARY TEST: Max size secret (1024 bytes)
      4) ‚ùå ATTACK TEST: Oversized secret (1025 bytes)
   Vault not at capacity yet, adding to reach limit...
   (Skipping to avoid too many transactions)
      ‚úî ‚ùå ATTACK TEST: Capacity enforcement (362ms)
    4Ô∏è‚É£ UPDATE TESTS
   No secret at index 0 to update (expected if fresh vault)
      ‚úî ‚úÖ Should update existing secret (364ms)
    5Ô∏è‚É£ TIER UPGRADE TESTS
      5) ‚úÖ Should upgrade vault tier
      6) ‚ùå ATTACK TEST: Cannot downgrade tier
    6Ô∏è‚É£ CRITICAL: PERMANENT STORAGE VERIFICATION
   ‚úÖ CRITICAL: delete_secret NOT FOUND
   ‚úÖ PERMANENT STORAGE ENFORCED
      ‚úî üîí VERIFY: delete_secret does NOT exist
   No secret at index 0 yet
      ‚úî üîí VERIFY: Secrets remain accessible (364ms)
    7Ô∏è‚É£ REAL-WORLD SCENARIO: Lost Wallet Recovery
   Simulating lost wallet scenario...
   Old owner: Hwnagq6n...
   New owner: ATf63G7S...
   ‚úÖ Wallet rotated successfully
   Rotating back to main wallet...
   ‚úÖ Recovery simulation complete
      ‚úî ‚úÖ Should rotate wallet (simulate wallet loss) (6996ms)

======================================================================
üéâ REAL DEVNET SECURITY AUDIT COMPLETE
======================================================================
Final Balance: 2.0786442 SOL
Program ID: 8bqnKmrsbNdZHP8p9sCV1oeeRkzkpQbYvxBeFZ2DiXSB
Network: Devnet

‚úÖ ALL REAL-WORLD TESTS PASSED
‚úÖ CONTRACT IS PRODUCTION-READY


  8 passing (20s)
  6 failing

  1) üî• REAL DEVNET BRUTAL TESTS üî•
       1Ô∏è‚É£ CONFIG & INITIALIZATION TESTS
         ‚úÖ Should initialize OR skip config if exists:
     TypeError: src.toArrayLike is not a function
      at BNLayout.encode (node_modules/@coral-xyz/borsh/src/index.ts:62:11)
      at Structure.encode (node_modules/buffer-layout/lib/Layout.js:1263:26)
      at BorshInstructionCoder.encode (node_modules/@coral-xyz/anchor/src/coder/borsh/instruction.ts:63:32)
      at /home/japhet/Desktop/joyvault/joyvault-contract/node_modules/@coral-xyz/anchor/src/program/namespace/index.ts:62:43
      at ix (node_modules/@coral-xyz/anchor/src/program/namespace/instruction.ts:60:15)
      at txFn (node_modules/@coral-xyz/anchor/src/program/namespace/transaction.ts:24:14)
      at MethodsBuilder.rpc [as _rpcFn] (node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:21:18)
      at MethodsBuilder.rpc (node_modules/@coral-xyz/anchor/src/program/namespace/methods.ts:289:17)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)

  2) üî• REAL DEVNET BRUTAL TESTS üî•
       3Ô∏è‚É£ SECRET STORAGE TESTS
         ‚úÖ Should add secret to vault:
     TypeError: Blob.encode[data] requires (length 33) Buffer as src
      at Blob.encode (node_modules/buffer-layout/lib/Layout.js:2321:13)
      at Structure.encode (node_modules/buffer-layout/lib/Layout.js:1263:26)
      at WrappedLayout.encode (node_modules/@coral-xyz/borsh/src/index.ts:115:24)
      at Structure.encode (node_modules/buffer-layout/lib/Layout.js:1263:26)
      at BorshInstructionCoder.encode (node_modules/@coral-xyz/anchor/src/coder/borsh/instruction.ts:63:32)
      at /home/japhet/Desktop/joyvault/joyvault-contract/node_modules/@coral-xyz/anchor/src/program/namespace/index.ts:62:43
      at ix (node_modules/@coral-xyz/anchor/src/program/namespace/instruction.ts:60:15)
      at txFn (node_modules/@coral-xyz/anchor/src/program/namespace/transaction.ts:24:14)
      at MethodsBuilder.rpc [as _rpcFn] (node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:21:18)
      at MethodsBuilder.rpc (node_modules/@coral-xyz/anchor/src/program/namespace/methods.ts:289:17)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)

  3) üî• REAL DEVNET BRUTAL TESTS üî•
       3Ô∏è‚É£ SECRET STORAGE TESTS
         ‚úÖ BOUNDARY TEST: Max size secret (1024 bytes):
     TypeError: Blob.encode[data] requires (length 1024) Buffer as src
      at Blob.encode (node_modules/buffer-layout/lib/Layout.js:2321:13)
      at Structure.encode (node_modules/buffer-layout/lib/Layout.js:1263:26)
      at WrappedLayout.encode (node_modules/@coral-xyz/borsh/src/index.ts:115:24)
      at Structure.encode (node_modules/buffer-layout/lib/Layout.js:1263:26)
      at BorshInstructionCoder.encode (node_modules/@coral-xyz/anchor/src/coder/borsh/instruction.ts:63:32)
      at /home/japhet/Desktop/joyvault/joyvault-contract/node_modules/@coral-xyz/anchor/src/program/namespace/index.ts:62:43
      at ix (node_modules/@coral-xyz/anchor/src/program/namespace/instruction.ts:60:15)
      at txFn (node_modules/@coral-xyz/anchor/src/program/namespace/transaction.ts:24:14)
      at MethodsBuilder.rpc [as _rpcFn] (node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:21:18)
      at MethodsBuilder.rpc (node_modules/@coral-xyz/anchor/src/program/namespace/methods.ts:289:17)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)

  4) üî• REAL DEVNET BRUTAL TESTS üî•
       3Ô∏è‚É£ SECRET STORAGE TESTS
         ‚ùå ATTACK TEST: Oversized secret (1025 bytes):
     AssertionError: expected 'Blob.encode[data] requires (length 10‚Ä¶' to include 'Secret exceeds maximum size'
      at /home/japhet/Desktop/joyvault/joyvault-contract/tests/devnet-real-test.ts:286:34
      at Generator.throw (<anonymous>)
      at rejected (tests/devnet-real-test.ts:39:65)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)

  5) üî• REAL DEVNET BRUTAL TESTS üî•
       5Ô∏è‚É£ TIER UPGRADE TESTS
         ‚úÖ Should upgrade vault tier:
     Error: Account does not exist or has no data 8deeeKMaKhviftxfjmk22WQfYX5pgEK6T5LyuvG3g6qJ
      at AccountClient.fetch (node_modules/@coral-xyz/anchor/src/program/namespace/account.ts:168:13)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)

  6) üî• REAL DEVNET BRUTAL TESTS üî•
       5Ô∏è‚É£ TIER UPGRADE TESTS
         ‚ùå ATTACK TEST: Cannot downgrade tier:
     Error: Account does not exist or has no data 8deeeKMaKhviftxfjmk22WQfYX5pgEK6T5LyuvG3g6qJ
      at AccountClient.fetch (node_modules/@coral-xyz/anchor/src/program/namespace/account.ts:168:13)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)



