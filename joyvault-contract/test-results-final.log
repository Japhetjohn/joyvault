(node:31729) [MODULE_TYPELESS_PACKAGE_JSON] Warning: Module type of file:///home/japhet/Desktop/joyvault/joyvault-contract/tests/devnet-real-test.ts is not specified and it doesn't parse as CommonJS.
Reparsing as ES module because module syntax was detected. This incurs a performance overhead.
To eliminate this warning, add "type": "module" to /home/japhet/Desktop/joyvault/joyvault-contract/package.json.
(Use `node --trace-warnings ...` to show where the warning was created)


  üî• REAL DEVNET BRUTAL TESTS üî•

üî• STARTING REAL DEVNET SECURITY AUDIT üî•

Main Wallet: Hwnagq6nu7tLMDYaaDLnQ4X4FiyfGv5hcMifYr13CZxd
Main Balance: 7.06708456 SOL

Funding test accounts from main wallet...
Note: Using alternative funding method...

    1Ô∏è‚É£ CONFIG & INITIALIZATION TESTS
   Config already initialized
   Admin: Hwnagq6nu7tLMDYaaDLnQ4X4FiyfGv5hcMifYr13CZxd
   Treasury: Hk2tjf3cF5GQEiuQHgbXAU3h5P3gYPmtSkVaKgCAQEpF
      ‚úî ‚úÖ Should check if config exists (383ms)
   Config exists, skipping initialization
      ‚úî ‚úÖ Should initialize OR skip config if exists (410ms)
    2Ô∏è‚É£ VAULT CREATION TESTS
   Vault already exists, owner: Hwnagq6nu7tLMDYaaDLnQ4X4FiyfGv5hcMifYr13CZxd
      ‚úî ‚úÖ Should create new vault OR fetch existing (411ms)
   ‚úÖ ATTACK BLOCKED: Duplicate vault rejected
      ‚úî ‚ùå ATTACK TEST: Cannot create duplicate vault (832ms)
    3Ô∏è‚É£ SECRET STORAGE TESTS
   Adding secret...
      1) ‚úÖ Should add secret to vault
   Testing 1024-byte secret...
      2) ‚úÖ BOUNDARY TEST: Max size secret (1024 bytes)
      3) ‚ùå ATTACK TEST: Oversized secret (1025 bytes)
   ‚úÖ ATTACK BLOCKED: Capacity limit enforced
      ‚úî ‚ùå ATTACK TEST: Capacity enforcement (1181ms)
    4Ô∏è‚É£ UPDATE TESTS
   No secret at index 0 to update (expected if fresh vault)
      ‚úî ‚úÖ Should update existing secret (1308ms)
    5Ô∏è‚É£ TIER UPGRADE TESTS
   Upgrading tier...
   ‚úÖ Tier upgraded successfully
      ‚úî ‚úÖ Should upgrade vault tier (4519ms)
   ‚úÖ ATTACK BLOCKED: Tier downgrade rejected
      ‚úî ‚ùå ATTACK TEST: Cannot downgrade tier (1566ms)
    6Ô∏è‚É£ CRITICAL: PERMANENT STORAGE VERIFICATION
   ‚úÖ CRITICAL: delete_secret NOT FOUND
   ‚úÖ PERMANENT STORAGE ENFORCED
      ‚úî üîí VERIFY: delete_secret does NOT exist
   ‚úÖ Secret persists on-chain (permanent)
   Created at: 2026-01-07T21:40:14.000Z
      ‚úî üîí VERIFY: Secrets remain accessible (387ms)
    7Ô∏è‚É£ REAL-WORLD SCENARIO: Lost Wallet Recovery
   Simulating lost wallet scenario...
   Old owner: Hwnagq6n...
   New owner: Ct5jYWqT...
   ‚úÖ Wallet rotated successfully
   Rotating back to main wallet...
   ‚úÖ Recovery simulation complete
      ‚úî ‚úÖ Should rotate wallet (simulate wallet loss) (5898ms)

======================================================================
üéâ REAL DEVNET SECURITY AUDIT COMPLETE
======================================================================
Final Balance: 2.06706456 SOL
Program ID: 8bqnKmrsbNdZHP8p9sCV1oeeRkzkpQbYvxBeFZ2DiXSB
Network: Devnet

‚úÖ ALL REAL-WORLD TESTS PASSED
‚úÖ CONTRACT IS PRODUCTION-READY


  11 passing (22s)
  3 failing

  1) üî• REAL DEVNET BRUTAL TESTS üî•
       3Ô∏è‚É£ SECRET STORAGE TESTS
         ‚úÖ Should add secret to vault:
     Error: AnchorError thrown in programs/joyvault-contract/src/lib.rs:60. Error Code: VaultCapacityReached. Error Number: 6000. Error Message: Vault capacity reached for current tier.
      at AnchorError.parse (node_modules/@coral-xyz/anchor/src/error.ts:152:14)
      at translateError (node_modules/@coral-xyz/anchor/src/error.ts:277:35)
      at MethodsBuilder.rpc [as _rpcFn] (node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:35:29)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)

  2) üî• REAL DEVNET BRUTAL TESTS üî•
       3Ô∏è‚É£ SECRET STORAGE TESTS
         ‚úÖ BOUNDARY TEST: Max size secret (1024 bytes):
     RangeError: encoding overruns Buffer
      at Blob.encode (node_modules/buffer-layout/lib/Layout.js:2325:13)
      at Structure.encode (node_modules/buffer-layout/lib/Layout.js:1263:26)
      at WrappedLayout.encode (node_modules/@coral-xyz/borsh/src/index.ts:115:24)
      at Structure.encode (node_modules/buffer-layout/lib/Layout.js:1263:26)
      at BorshInstructionCoder.encode (node_modules/@coral-xyz/anchor/src/coder/borsh/instruction.ts:63:32)
      at /home/japhet/Desktop/joyvault/joyvault-contract/node_modules/@coral-xyz/anchor/src/program/namespace/index.ts:62:43
      at ix (node_modules/@coral-xyz/anchor/src/program/namespace/instruction.ts:60:15)
      at txFn (node_modules/@coral-xyz/anchor/src/program/namespace/transaction.ts:24:14)
      at MethodsBuilder.rpc [as _rpcFn] (node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:21:18)
      at MethodsBuilder.rpc (node_modules/@coral-xyz/anchor/src/program/namespace/methods.ts:289:17)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)

  3) üî• REAL DEVNET BRUTAL TESTS üî•
       3Ô∏è‚É£ SECRET STORAGE TESTS
         ‚ùå ATTACK TEST: Oversized secret (1025 bytes):
     AssertionError: expected 'encoding overruns Buffer' to include 'Secret exceeds maximum size'
      at /home/japhet/Desktop/joyvault/joyvault-contract/tests/devnet-real-test.ts:286:34
      at Generator.throw (<anonymous>)
      at rejected (tests/devnet-real-test.ts:39:65)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)



